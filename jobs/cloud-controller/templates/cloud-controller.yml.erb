<%-
  ccdb = link('cloud_controller_db').p('ccdb')
  db = ccdb.fetch('databases').find { |db| db.fetch('tag') == 'cc' }
  db_user = ccdb.fetch('roles').find { |role| role.fetch('tag') == 'admin' }
  db_scheme = ccdb.fetch('db_scheme')
  connection_string = case db_scheme
  when 'postgres'
    "host=#{ccdb.fetch('address')} port=#{ccdb.fetch('port')} user=#{db_user.fetch('name')} dbname=#{db.fetch('name')} password=#{db_user.fetch('password')} sslmode=disable"
  when 'mysql'
    "#{db_user.fetch('name')}:#{db_user.fetch('password')}@tcp(#{ccdb.fetch('address')}:#{ccdb.fetch('port')})/#{db.fetch('name')}?tls=false&parseTime=true"
  else
    raise "ccdb.db_scheme #{db_scheme} is not supported"
  end
-%>
listen: 127.0.0.1:8282
db:
  connectionstring: <%= connection_string %>
  type: <%= db_scheme %>
  create: false
  migrate: false
log:
  level: debug
  production: false
uaa:
  url: <%= "https://#{p('uaa.internal_url')}:#{p('uaa.tls_port')}" %>